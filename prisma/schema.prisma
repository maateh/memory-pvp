generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  clerkId  String  @unique
  username String
  email    String  @unique
  imageUrl String?

  playerProfiles PlayerProfile[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PlayerProfile {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  tag      String  @unique
  color    String
  isActive Boolean

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @db.ObjectId

  results Result[]

  sessions      GameSession[] @relation("SessionOwner")
  guestSessions GameSession[] @relation("SessionGuest")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model GameSession {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  sessionId String @unique

  status GameStatus

  type      GameType
  mode      GameMode
  tableSize TableSize

  results Result[]

  owner   PlayerProfile @relation("SessionOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId String        @db.ObjectId

  guest   PlayerProfile? @relation("SessionGuest", fields: [guestId], references: [id], onDelete: Cascade)
  guestId String?        @db.ObjectId

  startedAt  DateTime
  finishedAt DateTime?
}

model Result {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  score Int
  timer Int

  session   GameSession @relation(fields: [sessionId], references: [sessionId], onDelete: Cascade)
  sessionId String

  playerProfile   PlayerProfile @relation(fields: [playerProfileId], references: [id], onDelete: Cascade)
  playerProfileId String        @db.ObjectId

  createdAt DateTime @default(now())
}

// ENUMS
enum GameStatus {
  RUNNING
  FINISHED
  ABANDONED
  OFFLINE
}

enum GameType {
  CASUAL
  COMPETITIVE
}

enum GameMode {
  SINGLE
  PVP
  COOP
}

enum TableSize {
  SMALL
  MEDIUM
  LARGE
}
